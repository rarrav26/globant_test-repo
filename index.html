<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Topic 1: Practice</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/reset.css">
		<link rel="stylesheet" type="text/css" href="css/normalize.css">
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<script type="text/javascript">
			$(document).ready(function(){
				$("#section").children().each(function(){
					$(this).fadeIn(1000);
				});
			});

			function getResponse(url){
				var xhttp = new XMLHttpRequest();
				xhttp.open("GET", url, true);
				xhttp.send();
				return xhttp;
			}

			function mensaje(tag, msg, huboError){
				if(huboError){
					$(tag).html("<span id='error' class='red'>" + msg + "</span>");
				} else {
					$(tag).html(msg);
				}
			};

			function jokeClick(){
				$("#mensaje").fadeOut('slow', function(){
					var xhttp = getResponse("http://api.icndb.com/jokes/random");

					xhttp.onload = function(){
						mensaje("#mensaje", JSON.parse(this.response).value.joke, false);
					}

					xhttp.onerror = function(){
						mensaje("#mensaje", "ERROR", true);
					}

					setTimeout(function(){$("#mensaje").fadeIn('slow');}, 1000);
				});
			};

			function buscarRepositorio(){
				var xhttp = getResponse("https://api.github.com/search/repositories?q=" + $("#buscar").val());

				xhttp.onload = function(){
					if(this.response == undefined){
						mensaje("#mensaje2", "No hay respuesta", true);
						return;
					} else if(xhttp.status == 403){
						mensaje("#mensaje2", "403 Forbidden", true);
						return;
					} else if(xhttp.status == 422){
						mensaje("#mensaje2", "422 Unprocesssable Entity", true);
						return;
					}
					var items = JSON.parse(this.response).items;
					if(items == undefined || items.length <= 0){
						mensaje("#mensaje2", "No hay resultados", true);
						return;
					}
					var resultado = [];
					items.forEach(function(item){
						resultado.push("<li>" + item.full_name + "</li>");
					});
					mensaje("#mensaje2", resultado, false);
				}

				xhttp.onprogress = function(){
					mensaje("#mensaje2", "Cargando...", false);
				}

				xhttp.onerror = function(){
					mensaje("#mensaje2", "ERROR", true);
				}
			};
		</script>
	</head>
	<body>
		<div id="contenedor">
			<header id="header">
				<!-- header -->
			</header>
			<nav id="nav">
				<!-- nav -->
			</nav>
			<section id="section">
				<h2 id="mensaje" style="display: none;">Hello world</h2>
				<button id="joke" type="button" style="display: none;" class="center-hor" onclick="jokeClick()">Joke</button>
				<br/>
				<br/>
				<div id="busqueda" class="center-hor" style="display: none;">
					<input id="buscar" type="text"/>
					<button type="button" onclick="buscarRepositorio()">Buscar</button>
				</div>
				<br/>
				<ul id="mensaje2" style="display: none;"></ul>
			</section>
			<aside id="aside">
				<!-- aside -->
			</aside>
			<div class="clear"></div>
			<footer id="footer">
				<!-- footer -->
			</footer>
		</div>
	</body>
</html>
